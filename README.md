# ESP32-C3 DSS Tool - Advanced Sensor Monitor

## üöÄ Overview
High-performance IoT monitoring system built on ESP32-C3 for industrial fuel and environmental sensors with optimized OLED interface and real-time hotswap detection.

## ‚ú® Key Features

### üéõ **Advanced User Interface**
- **Instant Response**: 10-50ms encoder response time (40-200x faster)
- **Inverted Highlights**: Professional menu selection with color inversion  
- **Two-Column Layout**: Fuel (left) ‚Üî SHT (right) with large fonts
- **Clean Design**: Minimalist interface, hidden advanced settings

### üîå **Smart Sensor Management**
- **Hotswap Detection**: Auto-detect sensors within 5 seconds
- **Dual Sensor Support**: SHT31/35 + Industrial fuel sensor
- **Real-time Monitoring**: Continuous connectivity checking
- **Visual/Audio Feedback**: LED + buzzer notifications

### üì± **Optimized Display**
- **128x32 OLED**: Perfect layout utilization
- **Large Fonts**: Size 2 for main values, excellent readability
- **Status Indicators**: Connection status, sensor health
- **Multi-mode Views**: Main, detail, calibration screens

### üéÆ **Intuitive Controls**
- **Single Click**: Navigate FUEL ‚Üî SHT
- **Click on Selection**: Enter detail view
- **Double Click**: Hidden calibration access
- **Long Press**: Execute calibration commands

## üîß Hardware Configuration

### ESP32-C3 DevKit M-1
- **MCU**: ESP32-C3 160MHz, 320KB RAM, 4MB Flash
- **Power**: 3.3V operation
- **Connectivity**: I2C, UART, GPIO interrupts

### Pin Assignments
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Component       ‚îÇ GPIO Pin        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ OLED SDA        ‚îÇ GPIO 6          ‚îÇ
‚îÇ OLED SCL        ‚îÇ GPIO 5          ‚îÇ
‚îÇ Encoder SW      ‚îÇ GPIO 8          ‚îÇ
‚îÇ Encoder DT      ‚îÇ GPIO 9          ‚îÇ
‚îÇ Encoder CLK     ‚îÇ GPIO 10         ‚îÇ
‚îÇ Fuel TX         ‚îÇ GPIO 1          ‚îÇ
‚îÇ Fuel RX         ‚îÇ GPIO 2          ‚îÇ
‚îÇ Buzzer          ‚îÇ GPIO 7          ‚îÇ
‚îÇ LED1 (System)   ‚îÇ GPIO 20         ‚îÇ
‚îÇ LED2 (Sensor)   ‚îÇ GPIO 21         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üì∫ **Display**: SSD1306 OLED 0.91"
- **Resolution**: 128x32 pixels
- **Interface**: I2C (0x3C)
- **Power**: 3.3V
- **Features**: High contrast, fast refresh

### üå° **SHT Sensor**: SHT31/35
- **Interface**: I2C (0x44 or 0x45)  
- **Range**: -40¬∞C to +125¬∞C, 0-100% RH
- **Accuracy**: ¬±0.3¬∞C, ¬±2% RH
- **Power**: 3.3V

### ‚õΩ **Fuel Sensor**: Industrial RS232
- **Protocol**: AoooG RS232 
- **Interface**: UART (9600 baud)
- **Data**: Temperature + fuel level
- **Calibration**: Set full/empty points

### üéö **Rotary Encoder**
- **Type**: Mechanical with button
- **Resolution**: 20-24 steps/revolution
- **Debounce**: Hardware + software (30ms)
- **Response**: Interrupt-driven

### üîä **Audio Feedback**
- **Buzzer**: 8530 PWM (2.7kHz)
- **Patterns**: Success, warning, error tones
- **Volume**: Software controlled

## üíª Software Architecture

### Core Libraries
- **DisplayManager**: Advanced OLED graphics and layouts
- **SHTSensor**: Temperature/humidity with error handling  
- **FuelSensor**: Industrial protocol with connectivity checks
- **RotaryEncoder**: Anti-jitter with multi-click detection
- **BuzzerManager**: Audio patterns and feedback

### Performance Optimizations
- **Separated Update Loops**: Sensors (2s) vs Display (50ms)
- **Force Update Mechanism**: Instant encoder feedback
- **Static Variable Caching**: Reduce computation overhead
- **Interrupt-driven Input**: Non-blocking encoder handling

## üéØ User Interface

### Main Screen Layout
```
‚îå‚îÄ‚îÄ‚îÄ DSS TOOL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  FUEL   ‚îÇ      SHT        ‚îÇ
‚îÇ   50L   ‚îÇ     25¬∞C        ‚îÇ
‚îÇ         ‚îÇ     60%         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Navigation Flow
```
Main Menu ‚Üí [Single Click] ‚Üí Detail View
    ‚Üì
[Double Click] ‚Üí Calibration Mode
    ‚Üì
[Long Press] ‚Üí Execute Command
```

## üõ† Development

### Build Requirements
- **PlatformIO**: Latest version
- **Platform**: espressif32
- **Framework**: arduino
- **Board**: esp32-c3-devkitm-1

### Dependencies
```ini
lib_deps = 
    adafruit/Adafruit SSD1306@^2.5.15
    adafruit/Adafruit GFX Library@^1.12.1
    adafruit/Adafruit BusIO@^1.17.2
    bblanchon/ArduinoJson@^6.21.5
```

### Build Commands
```bash
# Compile
platformio run

# Upload
platformio run --target upload --upload-port COM5

# Monitor
platformio device monitor --port COM5 --baud 115200
```

## üìä Performance Metrics
- **Response Time**: 10-50ms (encoder to display)
- **Sensor Update**: 2-second intervals  
- **Hotswap Detection**: 5-second intervals
- **Memory Usage**: 7.5KB RAM, 164KB Flash
- **Power Consumption**: ~80mA @ 3.3V

## üîÑ Recent Updates
- ‚úÖ Instant encoder response optimization
- ‚úÖ Inverted color highlights  
- ‚úÖ Two-column layout implementation
- ‚úÖ Hotswap sensor detection
- ‚úÖ Menu system streamlining
- ‚úÖ Enhanced visual feedback

## üìÑ License
This project is open source. See [LICENSE](LICENSE) for details.

## ü§ù Contributing
Contributions welcome! Please read [CHANGELOG.md](CHANGELOG.md) for recent updates.

---
*Built with ‚ù§Ô∏è for industrial IoT monitoring*

## T√≠nh nƒÉng
- ‚úÖ ƒê·ªçc c·∫£m bi·∫øn SHT31/35 t·ª´ ƒë·ªãa ch·ªâ I2C 0x44 v√† 0x45
- ‚úÖ Hi·ªÉn th·ªã d·ªØ li·ªáu l√™n m√†n h√¨nh OLED 0.91" (128x32)
- ‚úÖ 2 LED tr·∫°ng th√°i (h·ªá th·ªëng v√† c·∫£m bi·∫øn)
- ‚úÖ C√≤i b√°o v·ªõi c√°c √¢m thanh kh√°c nhau
- ‚úÖ T·ª± ƒë·ªông ph√°t hi·ªán c·∫£m bi·∫øn c√≥ s·∫µn
- ‚úÖ X·ª≠ l√Ω l·ªói khi c·∫£m bi·∫øn kh√¥ng k·∫øt n·ªëi
- ‚úÖ C·∫£nh b√°o nhi·ªát ƒë·ªô cao (>35¬∞C)
- ‚úÖ Output Serial Monitor ƒë·ªÉ debug
- ‚úÖ C·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªói 2 gi√¢y

## K·∫øt n·ªëi ph·∫ßn c·ª©ng

### ESP32-C3 DevKit M-1
- **SDA**: GPIO 6
- **SCL**: GPIO 5
- **LED1**: GPIO 20 (LED tr·∫°ng th√°i h·ªá th·ªëng)
- **LED2**: GPIO 21 (LED tr·∫°ng th√°i c·∫£m bi·∫øn)
- **BUZZER**: GPIO 7 (C√≤i b√°o)
- **VCC**: 3.3V
- **GND**: GND

### C·∫£m bi·∫øn SHT31/35
- **VCC** ‚Üí 3.3V
- **GND** ‚Üí GND  
- **SDA** ‚Üí GPIO 8
- **SCL** ‚Üí GPIO 9
- **ƒê·ªãa ch·ªâ I2C**: 0x44 ho·∫∑c 0x45

### M√†n h√¨nh OLED 0.91"
- **VCC** ‚Üí 3.3V
- **GND** ‚Üí GND
- **SDA** ‚Üí GPIO 8
- **SCL** ‚Üí GPIO 9
- **ƒê·ªãa ch·ªâ I2C**: 0x3C (m·∫∑c ƒë·ªãnh)

## C·∫•u tr√∫c project
```
tool fuel c3/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.cpp              # Code ch√≠nh
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ SHTSensor/            # Th∆∞ vi·ªán x·ª≠ l√Ω c·∫£m bi·∫øn SHT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SHTSensor.h
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SHTSensor.cpp
‚îÇ   ‚îú‚îÄ‚îÄ DisplayManager/       # Th∆∞ vi·ªán x·ª≠ l√Ω m√†n h√¨nh OLED
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DisplayManager.h
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DisplayManager.cpp
‚îÇ   ‚îî‚îÄ‚îÄ BuzzerManager/        # Th∆∞ vi·ªán x·ª≠ l√Ω buzzer PWM
‚îÇ       ‚îú‚îÄ‚îÄ BuzzerManager.h
‚îÇ       ‚îî‚îÄ‚îÄ BuzzerManager.cpp
‚îú‚îÄ‚îÄ platformio.ini            # C·∫•u h√¨nh project
‚îî‚îÄ‚îÄ README.md                 # File n√†y
```

## Th∆∞ vi·ªán s·ª≠ d·ª•ng
- `Adafruit SSD1306` - ƒêi·ªÅu khi·ªÉn m√†n h√¨nh OLED
- `Adafruit GFX Library` - Th∆∞ vi·ªán ƒë·ªì h·ªça
- `Adafruit BusIO` - Giao ti·∫øp I2C/SPI

## C√°ch s·ª≠ d·ª•ng

### 1. Build project
```bash
pio run
```

### 2. Upload code
```bash
pio run --target upload
```

### 3. Monitor Serial
```bash
pio device monitor
```

## Hi·ªÉn th·ªã m√†n h√¨nh

### M√†n h√¨nh kh·ªüi ƒë·ªông
```
Tool Fuel C3
Initializing...
SHT Sensors
```

### Hi·ªÉn th·ªã d·ªØ li·ªáu (m√†n h√¨nh nh·ªè 128x32)
```
SHT Sensor Data
Temp: 25.4 C
Hum:  60 %
```

### Hi·ªÉn th·ªã l·ªói
```
ERROR:
No SHT sensors found!
```

## Serial Monitor Output
```
Tool Fuel C3 - SHT Sensor Monitor
Initializing...
SHT sensor found at 0x44
SHT sensor found at 0x45
Found 2 SHT sensor(s)
Sensor 1 (0x44): 25.4¬∞C, 60%
Sensor 2 (0x45): 26.1¬∞C, 58%
---
```

## Ho·∫°t ƒë·ªông LED v√† Buzzer

### LED Tr·∫°ng th√°i
- **LED1 (GPIO 20)**: LED tr·∫°ng th√°i h·ªá th·ªëng
  - Nh√°y m·ªói gi√¢y khi h·ªá th·ªëng ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
  - Nh√°y nhanh khi c√≥ l·ªói kh·ªüi t·∫°o display
  
- **LED2 (GPIO 21)**: LED tr·∫°ng th√°i c·∫£m bi·∫øn  
  - S√°ng khi c√≥ √≠t nh·∫•t 1 c·∫£m bi·∫øn k·∫øt n·ªëi
  - Nh√°y theo chu k·ª≥ ƒë·ªçc d·ªØ li·ªáu th√†nh c√¥ng

### Buzzer PWM 8530 (GPIO 7)
- **Kh·ªüi ƒë·ªông**: Melody tƒÉng d·∫ßn (1kHz ‚Üí 1.5kHz ‚Üí 2kHz)
- **Ph√°t hi·ªán c·∫£m bi·∫øn**: 
  - Sensor 1: 1.8kHz, 100ms
  - Sensor 2: 2.2kHz, 100ms
- **Th√†nh c√¥ng**: 2.5kHz, 300ms khi ho√†n t·∫•t kh·ªüi t·∫°o
- **L·ªói**: Melody gi·∫£m d·∫ßn (800Hz ‚Üí 600Hz ‚Üí 400Hz)
- **C·∫£nh b√°o nhi·ªát ƒë·ªô**: Double beep 3kHz khi nhi·ªát ƒë·ªô > 35¬∞C
- **ƒê·ªçc l·ªói**: 500Hz, 200ms

## S·ª≠ d·ª•ng th∆∞ vi·ªán BuzzerManager

### Kh·ªüi t·∫°o
```cpp
#include "BuzzerManager.h"
BuzzerManager buzzer(BUZZER_PIN, 0);  // Pin 7, PWM channel 0

void setup() {
    buzzer.begin();  // Kh·ªüi t·∫°o buzzer
}
```

### C√°c h√†m c√≥ s·∫µn
```cpp
// ƒêi·ªÅu khi·ªÉn c∆° b·∫£n
buzzer.on();                    // B·∫≠t buzzer
buzzer.off();                   // T·∫Øt buzzer
buzzer.beep(100);              // Beep 100ms
buzzer.beepTone(2000, 200);    // Beep 2kHz trong 200ms

// √Çm thanh ƒë·ªãnh s·∫µn
buzzer.playStartupSequence();   // Melody kh·ªüi ƒë·ªông
buzzer.playSensorFound(1);      // √Çm b√°o t√¨m th·∫•y sensor 1
buzzer.playSensorFound(2);      // √Çm b√°o t√¨m th·∫•y sensor 2
buzzer.playSuccess();           // √Çm b√°o th√†nh c√¥ng
buzzer.playError();             // √Çm b√°o l·ªói
buzzer.playWarning();           // √Çm b√°o c·∫£nh b√°o
buzzer.playTemperatureAlert();  // √Çm b√°o nhi·ªát ƒë·ªô cao
buzzer.playReadError();         // √Çm b√°o l·ªói ƒë·ªçc

// C·∫•u h√¨nh
buzzer.setDefaultFrequency(2700);  // ƒê·∫∑t t·∫ßn s·ªë m·∫∑c ƒë·ªãnh
buzzer.setDutyCycle(128);          // ƒê·∫∑t duty cycle (0-255)
```

## Tu·ª≥ ch·ªânh

### Thay ƒë·ªïi ch√¢n LED v√† Buzzer
```cpp
#define LED1_PIN 20      // LED tr·∫°ng th√°i h·ªá th·ªëng
#define LED2_PIN 21      // LED tr·∫°ng th√°i c·∫£m bi·∫øn  
#define BUZZER_PIN 7     // C√≤i PWM 8530
```

### Tu·ª≥ ch·ªânh √¢m thanh buzzer 8530
```cpp
// Thay ƒë·ªïi t·∫ßn s·ªë chu·∫©n
const int BUZZER_FREQ = 2700;  // 2.7kHz cho 8530

// S·ª≠ d·ª•ng t·∫ßn s·ªë t√πy ch·ªânh
beepTone(1500, 200);  // 1.5kHz trong 200ms

// Thay ƒë·ªïi duty cycle (√¢m l∆∞·ª£ng)
const int BUZZER_DUTY = 128;  // 50% (0-255)
```

### Thay ƒë·ªïi ng∆∞·ª°ng c·∫£nh b√°o nhi·ªát ƒë·ªô
```cpp
if ((temp1 > 35.0 && !isnan(temp1)) || (temp2 > 35.0 && !isnan(temp2))) {
    beepTone(3000, 100); // Thay ƒë·ªïi 35.0 v√† t·∫ßn s·ªë c·∫£nh b√°o
    delay(100);
    beepTone(3000, 100); // Double beep
}
```

## ƒê·∫∑c ƒëi·ªÉm Buzzer 8530
- **Lo·∫°i**: Magnetic buzzer PWM
- **ƒêi·ªán √°p ho·∫°t ƒë·ªông**: 3-5V DC  
- **T·∫ßn s·ªë t·ªëi ∆∞u**: 2.7kHz (2700Hz)
- **D√≤ng ti√™u th·ª•**: ~30mA
- **√Çm l∆∞·ª£ng**: 85dB t·∫°i 10cm
- **ƒêi·ªÅu khi·ªÉn**: PWM v·ªõi duty cycle 50%

### Thay ƒë·ªïi ch√¢n I2C
S·ª≠a trong `main.cpp`:
```cpp
#define SDA_PIN 6
#define SCL_PIN 5
```

### Thay ƒë·ªïi t·∫ßn su·∫•t ƒë·ªçc
S·ª≠a trong `main.cpp`:
```cpp
const unsigned long READ_INTERVAL = 2000; // milliseconds
```

### Thay ƒë·ªïi ƒë·ªãa ch·ªâ OLED
S·ª≠a trong `main.cpp`:
```cpp
DisplayManager display(128, 32, 0x3C);  // 0x3C ho·∫∑c 0x3D
```

## Troubleshooting

### 1. M√†n h√¨nh OLED kh√¥ng s√°ng
- Ki·ªÉm tra k·∫øt n·ªëi I2C
- Th·ª≠ ƒë·ªãa ch·ªâ 0x3D thay v√¨ 0x3C
- Ki·ªÉm tra ngu·ªìn 3.3V

### 2. Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c c·∫£m bi·∫øn
- Ki·ªÉm tra k·∫øt n·ªëi I2C
- Ki·ªÉm tra ƒë·ªãa ch·ªâ c·∫£m bi·∫øn (0x44 ho·∫∑c 0x45)
- Ki·ªÉm tra ngu·ªìn 3.3V

### 3. Build failed
- Ki·ªÉm tra th∆∞ vi·ªán ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t ƒë√∫ng
- X√≥a folder `.pio` v√† build l·∫°i

## Ph√°t tri·ªÉn th√™m
- [ ] Th√™m WiFi connectivity
- [ ] L∆∞u d·ªØ li·ªáu v√†o SPIFFS
- [ ] Web interface
- [ ] C·∫£nh b√°o ng∆∞·ª°ng
- [ ] Bluetooth Low Energy